# 用户态系统调用

## 先把Rcore-N跑起来

首先看了[项晨东学长的项目](https://github.com/OS-F-4/usr-intr?tab=readme-ov-file)

```markdown
../configure --enable-debug  --target-list=x86_64-softmmu
#../configure运行上一级目录的配置脚本，configure脚本用于检测系统环境并生成适合当前环境的Makefile文件，以便后续编译使用。
```

```markdown
$qemubase/qemu/build/x86_64-softmmu/qemu-system-x86_64 -smp 2 \ #处理器个数
-m 1024M   -nographic  \  #内存大小
-kernel $kernelbase/bzImage \ #编译生成的内核镜像存放位置
-initrd $fsbase/initramfs-busybox-x86_64.cpio.gz \ #文件系统位置
-append "root=/dev/ram0 rw rootfstype=ext4 console=ttyS0 init=/linuxrc" #附加参数
```

后面改主意了，想先跑起来再说，去看了zfl学长的[rcore-N](https://github.com/zflcs/rCore-N?tab=readme-ov-file)，他这个是[田凯夫的rcore-N](https://github.com/Gallium70/rv-n-ext-impl)的子模块，按理说能跑起来其中一个另外一个应该也没问题的

先搭好对应qemu环境（要支持N拓展的qemu才行，[帮助文档](https://gallium70.github.io/rv-n-ext-impl/ch6_0_user_guide.html)在这里

随后把tkf的rcore-N拉下来



### 问题

#### qemu过不了编译？

拉下来编译的时候遇到以下问题

```markdown
git clone https://github.com/duskmoon314/qemu.git
mkdir qemu-build
cd qemu-build
../qemu/configure --target-list="riscv64-softmmu"
make -j8
```

<img src="D:\116\sigs\my_OScamps_blog\异步系统调用方面的一些探索\用户态系统调用.assets\image-20240530193118226.png" alt="image-20240530193118226" />

解决（也不完全是解决方案：加上`--extra-cflags = -Wno-error` 

让编译器不要将一些警告视为错误，这样就可以过编译

```
../qemu/configure --target-list="riscv64-softmmu" --extra-cflags=-Wno-error
```

#### Rcore-N编译不了？

下图是跑zfl学长的rcore-N碰到的问题，在群里和帮助文档找了一下也没找着怎么解决，于是先放着不动了……

<img src="D:\116\sigs\my_OScamps_blog\异步系统调用方面的一些探索\用户态系统调用.assets\image-20240530200820962.png" alt="image-20240530200820962" />

解决思路：

如果你拉下来的项目没有`rust-toolchain`文件的话，你需要手动创建一个

```markdown
echo "nightly" > rust-toolchain //先写一个nightly进去，后续也要更改
```

创建完毕之后，编辑这个文件，替换版本

```
[toolchain]
profile ="minimal"
# use the nightly version of the last stable toolchain
channel ="nightly-2023-01-03"
components =["rust-src","llvm-tools-preview","rustfmt","clippy"]
```





tkf学长的rcore-N也是过不了编译

<img src="D:\116\sigs\my_OScamps_blog\异步系统调用方面的一些探索\用户态系统调用.assets\image-20240530202629975.png" alt="image-20240530202629975" />

